<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskee - Gestor de Tareas con Estilo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6C63FF;
            --primary-dark: #564FD8;
            --primary-light: #8f87ff;
            --secondary: #36D1DC;
            --accent: #FF6B6B;
            --success: #4CC9F0;
            --warning: #FFD166;
            --danger: #F94144;
            --light: #F8F9FA;
            --dark: #212529;
            --gray: #6C757D;
            --light-gray: #E9ECEF;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.25);
            --radius: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--dark);
            transition: var(--transition);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: white;
            text-decoration: none;
            z-index: 1000;
            transition: var(--transition);
        }

        .back-button:hover {
            transform: scale(1.1);
        }

        .theme-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-btn.active {
            transform: scale(1.15);
            box-shadow: 0 0 0 3px white;
        }

        .theme-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .theme-blue { background: linear-gradient(135deg, #36D1DC 0%, #5B86E5 100%); }
        .theme-sunset { background: linear-gradient(135deg, #ff6b6b 0%, #ff9a3c 100%); }
        .theme-green { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        .container {
            width: 100%;
            max-width: 920px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 20px 0;
            transition: var(--transition);
            transform: translateY(0);
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }


        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 50%, var(--primary) 100%);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .logo-icon {
            font-size: 2.8rem;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #fad0c4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2));
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .app-description {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 10px;
            position: relative;
            z-index: 2;
        }

        .notification-permission {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .notification-permission p {
            margin: 0;
        }

        #enable-notifications {
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #enable-notifications:hover {
            background: #e55c5c;
            transform: translateY(-2px);
        }

        .sound-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .sound-toggle {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .sound-toggle.muted {
            background: rgba(249, 65, 68, 0.3);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 30px;
            background: linear-gradient(to bottom, #f8f9fa, #ffffff);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(108, 99, 255, 0.2), transparent);
        }

        .stat-card {
            background: white;
            padding: 28px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(108, 99, 255, 0.1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 30px rgba(108, 99, 255, 0.15);
            border-color: var(--primary);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            letter-spacing: -1px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.95rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-form {
            padding: 30px;
            background: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .form-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        #task-input {
            flex: 1;
            padding: 18px 20px;
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: var(--radius);
            font-size: 1.05rem;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            background: #fafbfc;
        }

        #task-input::placeholder {
            color: #a0a0a0;
        }

        #task-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.15);
            background: white;
            transform: translateY(-1px);
        }

        #add-task-btn {
            padding: 18px 32px;
            background: linear-gradient(135deg, var(--accent) 0%, #e85d5d 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        #add-task-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.45);
        }

        #add-task-btn:active {
            transform: translateY(-1px);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-weight: 500;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .input-group input, .input-group select {
            padding: 12px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        .input-group input:focus, .input-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        .priority-selectors {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .priority-btn {
            padding: 10px 18px;
            border: 2px solid rgba(0, 0, 0, 0.08);
            border-radius: 50px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-sm);
        }

        .priority-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .priority-btn.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(108, 99, 255, 0.15), rgba(108, 99, 255, 0.05));
            color: var(--primary);
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.2);
        }

        .priority-low.active {
            border-color: var(--success);
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        .priority-medium.active {
            border-color: var(--warning);
            background: rgba(255, 209, 102, 0.1);
            color: #d89e00;
        }

        .priority-high.active {
            border-color: var(--danger);
            background: rgba(249, 65, 68, 0.1);
            color: var(--danger);
        }

        .filters {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background: white;
            border-bottom: 1px solid var(--light-gray);
        }

        .filter-group {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 10px 22px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
            border-color: transparent;
        }

        .filter-btn:hover:not(.active) {
            color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
            border-color: rgba(108, 99, 255, 0.3);
            transform: translateY(-2px);
        }

        .sort-select {
            padding: 10px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 50px;
            background: white;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .sort-select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        .tasks-container {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 24px;
            background: white;
            border-radius: var(--radius);
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid var(--primary);
            position: relative;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-item.low-priority {
            border-left-color: var(--success);
        }

        .task-item.medium-priority {
            border-left-color: var(--warning);
        }

        .task-item.high-priority {
            border-left-color: var(--danger);
        }

        .task-item.urgent {
            animation: pulse 2s infinite;
            border-left-color: var(--danger);
        }

        .task-item:hover {
            transform: translateY(-4px) translateX(4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
            border-left-width: 6px;
        }

        .task-checkbox {
            margin-right: 20px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--success);
            flex-shrink: 0;
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .task-text {
            font-size: 1.1rem;
            transition: var(--transition);
            word-break: break-word;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .task-priority {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .priority-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .priority-low .priority-dot {
            background: var(--success);
        }

        .priority-medium .priority-dot {
            background: var(--warning);
        }

        .priority-high .priority-dot {
            background: var(--danger);
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: var(--gray);
        }

        .task-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .task-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-btn {
            color: var(--primary);
        }

        .edit-btn:hover {
            background: rgba(108, 99, 255, 0.1);
            transform: rotate(15deg);
        }

        .delete-btn {
            color: var(--danger);
        }

        .delete-btn:hover {
            background: rgba(249, 65, 68, 0.1);
            transform: rotate(15deg);
        }

        .reminder-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            animation: pulse 1.5s infinite;
        }

        .task-stats {
            padding: 25px 30px;
            background: linear-gradient(to top, #f8f9fa, #ffffff);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            gap: 20px;
        }

        .progress-container {
            flex: 1;
            max-width: 300px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 8px;
            background: rgba(108, 99, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .clear-btn {
            padding: 10px 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clear-btn:hover {
            background: #e02d30;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(249, 65, 68, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dee2e6;
            animation: bounce 2s infinite;
        }

        .empty-state p {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .empty-state .btn {
            padding: 12px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .empty-state .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 99, 255, 0.4);
        }

        /* Notificaciones */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            padding: 15px 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            transition: var(--transition);
        }

        .notification:hover {
            transform: translateX(-5px);
        }

        .notification-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.warning .notification-icon {
            color: var(--warning);
        }

        .notification.danger .notification-icon {
            color: var(--danger);
        }

        .notification.info .notification-icon {
            color: var(--primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .notification-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .notification-close:hover {
            color: var(--dark);
            transform: rotate(90deg);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }


        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(249, 65, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(249, 65, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(249, 65, 68, 0); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                margin: 10px 0;
                border-radius: 20px;
            }

            header {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2.4rem;
            }

            .app-description {
                font-size: 1rem;
            }

            .dashboard {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 20px;
            }

            .stat-card {
                padding: 24px;
            }

            .stat-number {
                font-size: 2.5rem;
            }

            .task-form {
                padding: 20px;
            }

            .form-group {
                flex-direction: column;
                gap: 12px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            #task-input {
                padding: 16px 18px;
                font-size: 1rem;
            }

            #add-task-btn {
                justify-content: center;
                padding: 16px 28px;
                width: 100%;
            }

            .priority-selectors {
                flex-wrap: wrap;
                gap: 8px;
            }

            .priority-btn {
                flex: 1;
                min-width: calc(33.333% - 6px);
                justify-content: center;
                padding: 10px 12px;
                font-size: 0.85rem;
            }

            .filters {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .filter-group {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .filter-btn {
                font-size: 0.9rem;
                padding: 9px 18px;
            }

            .sort-select {
                width: 100%;
                text-align: center;
            }

            .tasks-container {
                padding: 15px;
                max-height: 350px;
            }

            .task-item {
                padding: 18px;
                margin-bottom: 12px;
            }

            .task-text {
                font-size: 1rem;
            }

            .task-meta {
                flex-wrap: wrap;
                gap: 10px;
            }

            .task-actions {
                position: absolute;
                top: 15px;
                right: 15px;
            }

            .task-btn {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }

            .task-stats {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }

            .progress-container {
                max-width: 100%;
            }

            .clear-btn {
                width: 100%;
                justify-content: center;
            }

            .notification {
                max-width: calc(100vw - 40px);
                margin: 0 10px;
            }

            .notification-permission {
                flex-direction: column;
                text-align: center;
                padding: 12px;
                gap: 12px;
            }

            .sound-controls {
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }

            .sound-toggle, #test-sound {
                width: 100%;
                justify-content: center;
            }

            .theme-selector {
                top: 10px;
                right: 10px;
                gap: 8px;
            }

            .theme-btn {
                width: 26px;
                height: 26px;
            }

            .back-button {
                top: 10px;
                left: 10px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }

            .stat-number {
                font-size: 2.2rem;
            }

            .priority-btn {
                min-width: 100%;
            }

            .task-item {
                padding: 16px;
            }
        }
    </style>
    </head>
<body>
        <a href="../index.html" class="back-button"><i class="fas fa-arrow-left"></i></a>
    <div class="theme-selector">
        <button class="theme-btn theme-purple active" data-theme="purple"></button>
        <button class="theme-btn theme-blue" data-theme="blue"></button>
        <button class="theme-btn theme-sunset" data-theme="sunset"></button>
        <button class="theme-btn theme-green" data-theme="green"></button>
    </div>

    <div class="notification-container" id="notification-container">
        <!-- Notificaciones aparecerán aquí -->
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-bell logo-icon"></i>
                <h1>Taskee</h1>
            </div>
            <p class="app-description">Tu gestor de tareas con recordatorios sonoros</p>
            
            <div class="notification-permission" id="notification-permission-panel">
                <p><i class="fas fa-info-circle"></i> Habilita las notificaciones para recibir recordatorios</p>
                <button id="enable-notifications">
                    <i class="fas fa-bell"></i> Activar notificaciones
                </button>
            </div>
            
            <div class="sound-controls">
                <button id="sound-toggle" class="sound-toggle">
                    <i class="fas fa-volume-up"></i> Sonido Activado
                </button>
                <button id="test-sound" class="sound-toggle">
                    <i class="fas fa-play"></i> Probar sonido
                </button>
            </div>
        </header>

        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-number" id="total-tasks">0</div>
                <div class="stat-label">Tareas Totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completed-tasks">0</div>
                <div class="stat-label">Completadas</div>
            </div>
        </div>

        <div class="task-form">
            <div class="form-group">
                <input type="text" id="task-input" placeholder="¿Qué necesitas hacer?">
                <button id="add-task-btn">
                    <i class="fas fa-plus"></i> Agregar
                </button>
            </div>
            
            <div class="form-row">
                <div class="input-group">
                    <label for="reminder-date"><i class="fas fa-calendar"></i> Fecha recordatorio</label>
                    <input type="date" id="reminder-date">
                </div>
                <div class="input-group">
                    <label for="reminder-time"><i class="fas fa-clock"></i> Hora recordatorio</label>
                    <input type="time" id="reminder-time">
                </div>
            </div>
            
            <div class="priority-selectors">
                <button class="priority-btn priority-low active" data-priority="low">
                    <i class="fas fa-arrow-down"></i> Baja
                </button>
                <button class="priority-btn priority-medium" data-priority="medium">
                    <i class="fas fa-minus"></i> Media
                </button>
                <button class="priority-btn priority-high" data-priority="high">
                    <i class="fas fa-arrow-up"></i> Alta
                </button>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-list"></i> Todas
                </button>
                <button class="filter-btn" data-filter="pending">
                    <i class="fas fa-clock"></i> Pendientes
                </button>
                <button class="filter-btn" data-filter="completed">
                    <i class="fas fa-check-circle"></i> Completadas
                </button>
            </div>
            <select class="sort-select" id="sort-select">
                <option value="newest">Más recientes primero</option>
                <option value="oldest">Más antiguas primero</option>
                <option value="priority">Por prioridad</option>
                <option value="reminder">Por recordatorio</option>
            </select>
        </div>

        <div class="tasks-container">
            <ul class="task-list" id="task-list">
                <!-- Las tareas se agregarán aquí dinámicamente -->
            </ul>
        </div>

        <div class="task-stats">
            <div class="progress-container">
                <div class="progress-label">
                    <span>Progreso</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-bar-wrapper">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
            </div>
            <button class="clear-btn" id="clear-btn">
                <i class="fas fa-trash"></i> Limpiar completadas
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos del DOM
            const taskInput = document.getElementById('task-input');
            const addTaskBtn = document.getElementById('add-task-btn');
            const taskList = document.getElementById('task-list');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const priorityBtns = document.querySelectorAll('.priority-btn');
            const sortSelect = document.getElementById('sort-select');
            const totalTasksEl = document.getElementById('total-tasks');
            const completedTasksEl = document.getElementById('completed-tasks');
            const progressText = document.getElementById('progress-text');
            const clearBtn = document.getElementById('clear-btn');
            const reminderDate = document.getElementById('reminder-date');
            const reminderTime = document.getElementById('reminder-time');
            const notificationContainer = document.getElementById('notification-container');
            const enableNotificationsBtn = document.getElementById('enable-notifications');
            const notificationPermissionPanel = document.getElementById('notification-permission-panel');
            const soundToggle = document.getElementById('sound-toggle');
            const testSoundBtn = document.getElementById('test-sound');
            const themeButtons = document.querySelectorAll('.theme-btn');
            
            // Variables de estado
            let tasks = [];
            let currentFilter = 'all';
            let currentPriority = 'low';
            let currentSort = 'newest';
            let editTaskId = null;
            let notificationCheckInterval;
            let notificationPermission = false;
            let soundEnabled = true;
            let audioContext = null;
            let reminderTimers = {};
            
            // Inicializar la aplicación
            initApp();
            
            // Función de inicialización
            function initApp() {
                // Cargar tareas desde localStorage
                loadTasks();
                updateStats();
                
                // Cargar preferencia de sonido
                const soundPreference = localStorage.getItem('taskee-sound-enabled');
                if (soundPreference !== null) {
                    soundEnabled = soundPreference === 'true';
                    updateSoundToggle();
                }
                
                // Cargar tema preferido
                const savedTheme = localStorage.getItem('taskee-theme') || 'purple';
                changeTheme(savedTheme);

                // Registrar Service Worker para mejorar compatibilidad y caché
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').catch(err => {
                        console.warn('Fallo al registrar el Service Worker:', err);
                    });
                }
                
                // ===== Push API: suscripción para notificaciones persistentes (fuera de la app) =====
                const VAPID_PUBLIC_KEY = 'REEMPLAZA_CON_TU_VAPID_PUBLIC_KEY'; // TODO: clave pública VAPID

                function urlBase64ToUint8Array(base64String) {
                    const padding = '='.repeat((4 - (base64String.length % 4)) % 4);
                    const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
                    const rawData = atob(base64);
                    const outputArray = new Uint8Array(rawData.length);
                    for (let i = 0; i < rawData.length; ++i) {
                        outputArray[i] = rawData.charCodeAt(i);
                    }
                    return outputArray;
                }

                async function subscribePush() {
                    try {
                        if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
                            return; // No compatible
                        }
                        const reg = await navigator.serviceWorker.ready;
                        let sub = await reg.pushManager.getSubscription();
                        if (!sub) {
                            if (!VAPID_PUBLIC_KEY || VAPID_PUBLIC_KEY.includes('REEMPLAZA')) {
                                console.warn('Falta VAPID_PUBLIC_KEY para suscripción Push.');
                                return;
                            }
                            sub = await reg.pushManager.subscribe({
                                userVisibleOnly: true,
                                applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
                            });
                        }
                        localStorage.setItem('taskee-push-subscription', JSON.stringify(sub));
                        showNotification('Notificaciones externas listas', 'Suscripción Push creada', 'success');
                        console.log('Push Subscription:', JSON.stringify(sub));
                        // TODO: enviar la suscripción al backend
                    } catch (err) {
                        console.error('Error al suscribirse a Push:', err);
                        showNotification('No se pudo activar Push', 'Revisa consola y VAPID', 'error');
                    }
                }
                
                // Comprobar si las notificaciones están soportadas
                if (!('Notification' in window)) {
                    showNotification('No compatible', 'Tu navegador no soporta notificaciones nativas', 'warning');
                    notificationPermissionPanel.style.display = 'none';
                    return;
                }
                
                // Comprobar el estado de permiso de notificaciones
                if (Notification.permission === 'granted') {
                    notificationPermission = true;
                    notificationPermissionPanel.style.display = 'none';
                    // Preparar suscripción Push para notificaciones externas
                    subscribePush();
                    startNotificationChecker();
                    // Comprobar inmediatamente por si ya hay recordatorios próximos
                    checkReminders();
                    // Programar recordatorios existentes
                    rescheduleAllReminders();
                } else if (Notification.permission === 'denied') {
                    notificationPermissionPanel.innerHTML = '<p><i class="fas fa-bell-slash"></i> Las notificaciones están bloqueadas para este sitio</p>';
                }
                
                // Configurar event listeners
                setupEventListeners();
            }
            
            // Configurar event listeners
            function setupEventListeners() {
                addTaskBtn.addEventListener('click', addTask);
                taskInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') addTask();
                });
                
                filterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        filterBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentFilter = btn.dataset.filter;
                        renderTasks();
                    });
                });
                
                priorityBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        priorityBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentPriority = btn.dataset.priority;
                    });
                });
                
                sortSelect.addEventListener('change', () => {
                    currentSort = sortSelect.value;
                    renderTasks();
                });
                
                clearBtn.addEventListener('click', clearCompletedTasks);
                
                enableNotificationsBtn.addEventListener('click', requestNotificationPermission);
                
                soundToggle.addEventListener('click', toggleSound);
                testSoundBtn.addEventListener('click', playTestSound);
                
                themeButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const theme = btn.dataset.theme;
                        changeTheme(theme);
                    });
                });
            }
            
            // Cambiar tema de la aplicación
            function changeTheme(theme) {
                // Actualizar botones de tema
                themeButtons.forEach(btn => {
                    if (btn.dataset.theme === theme) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Cambiar variables CSS según el tema
                const root = document.documentElement;
                switch(theme) {
                    case 'blue':
                        root.style.setProperty('--primary', '#36D1DC');
                        root.style.setProperty('--primary-dark', '#5B86E5');
                        root.style.setProperty('--background', 'linear-gradient(135deg, #36D1DC 0%, #5B86E5 100%)');
                        break;
                    case 'sunset':
                        root.style.setProperty('--primary', '#FF6B6B');
                        root.style.setProperty('--primary-dark', '#FF9A3C');
                        root.style.setProperty('--background', 'linear-gradient(135deg, #ff6b6b 0%, #ff9a3c 100%)');
                        break;
                    case 'green':
                        root.style.setProperty('--primary', '#43e97b');
                        root.style.setProperty('--primary-dark', '#38f9d7');
                        root.style.setProperty('--background', 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)');
                        break;
                    default: // purple
                        root.style.setProperty('--primary', '#6C63FF');
                        root.style.setProperty('--primary-dark', '#564FD8');
                        root.style.setProperty('--background', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)');
                }
                
                // Guardar preferencia
                localStorage.setItem('taskee-theme', theme);
            }
            
            // Inicializar el contexto de audio
            function initAudioContext() {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                return audioContext;
            }
            
            // Crear sonidos usando Web Audio API
            function createSound(frequency, type, duration = 0.5) {
                if (!soundEnabled) return;
                
                try {
                    const context = initAudioContext();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    
                    oscillator.type = type;
                    oscillator.frequency.value = frequency;
                    
                    gainNode.gain.setValueAtTime(0.3, context.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + duration);
                    
                    oscillator.start(context.currentTime);
                    oscillator.stop(context.currentTime + duration);
                } catch (error) {
                    console.error('Error creando sonido:', error);
                }
            }
            
            // Alternar sonido
            function toggleSound() {
                soundEnabled = !soundEnabled;
                localStorage.setItem('taskee-sound-enabled', soundEnabled);
                updateSoundToggle();
                
                if (soundEnabled) {
                    playSound('taskee');
                    showNotification('Sonido activado', 'Los sonidos de notificación están ahora activados', 'success');
                } else {
                    showNotification('Sonido desactivado', 'Los sonidos de notificación están ahora desactivados', 'info');
                }
            }
            
            // Actualizar apariencia del botón de sonido
            function updateSoundToggle() {
                if (soundEnabled) {
                    soundToggle.innerHTML = '<i class="fas fa-volume-up"></i> Sonido Activado';
                    soundToggle.classList.remove('muted');
                } else {
                    soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i> Sonido Desactivado';
                    soundToggle.classList.add('muted');
                }
            }
            
            // Probar sonido
            function playTestSound() {
                if (soundEnabled) {
                    playSound('taskee');
                    showNotification('Sonido de prueba', 'Reproduciendo sonido de prueba', 'info');
                } else {
                    showNotification('Sonido desactivado', 'Activa el sonido para probarlo', 'warning');
                }
            }
            
            // Reproducir sonido según el tipo
            function playSound(type) {
                if (!soundEnabled) return;
                
                try {
                    switch(type) {
                        case 'notification':
                            createSound(800, 'sine', 0.3);
                            setTimeout(() => createSound(1000, 'sine', 0.3), 150);
                            break;
                        case 'success':
                            createSound(523.25, 'sine', 0.2); // Do
                            setTimeout(() => createSound(659.25, 'sine', 0.2), 200); // Mi
                            setTimeout(() => createSound(783.99, 'sine', 0.4), 400); // Sol
                            break;
                        case 'warning':
                            createSound(400, 'sawtooth', 0.5);
                            setTimeout(() => createSound(300, 'sawtooth', 0.5), 500);
                            break;
                        case 'taskee':
                        default:
                            createSound(660, 'sine', 0.1); // T
                            setTimeout(() => createSound(880, 'sine', 0.1), 100); // A
                            setTimeout(() => createSound(1100, 'sine', 0.1), 200); // S
                            setTimeout(() => createSound(1320, 'sine', 0.1), 300); // K
                            setTimeout(() => createSound(1760, 'sine', 0.2), 400); // E
                            setTimeout(() => createSound(2200, 'sine', 0.3), 600); // E
                            break;
                    }
                } catch (error) {
                    console.error('Error reproduciendo sonido:', error);
                }
            }
            
            // Solicitar permiso para notificaciones
            function requestNotificationPermission() {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        notificationPermission = true;
                        notificationPermissionPanel.style.display = 'none';
                        // Preparar suscripción Push para notificaciones persistentes
                        subscribePush();
                        startNotificationChecker();
                        // Reprogramar recordatorios ahora que hay permiso
                        rescheduleAllReminders();
                        showNotification('Notificaciones activadas', 'Ahora recibirás recordatorios de tus tareas', 'success');
                        playSound('success');
                    } else {
                        showNotification('Permiso denegado', 'No podrás recibir notificaciones de recordatorios', 'warning');
                        playSound('warning');
                    }
                });
            }
            
            // Función para agregar una nueva tarea
            function addTask() {
                const taskText = taskInput.value.trim();
                
                if (taskText === '') {
                    showNotification('Error', 'Por favor, escribe una tarea', 'danger');
                    playSound('warning');
                    return;
                }
                
                // Obtener fecha y hora de recordatorio
                let reminderDateTime = null;
                if (reminderDate.value && reminderTime.value) {
                    reminderDateTime = new Date(`${reminderDate.value}T${reminderTime.value}`);
                    // Verificar que la fecha sea válida y en el futuro
                    if (isNaN(reminderDateTime.getTime()) || reminderDateTime <= new Date()) {
                        showNotification('Error', 'La fecha y hora del recordatorio deben ser futuras', 'danger');
                        playSound('warning');
                        return;
                    }
                }
                
                if (editTaskId !== null) {
                    // Estamos en modo edición
                    tasks = tasks.map(task => {
                        if (task.id === editTaskId) {
                            return { 
                                ...task, 
                                text: taskText,
                                priority: currentPriority,
                                reminder: reminderDateTime,
                                notified: false
                            };
                        }
                        return task;
                    });

                    // Reprogramar recordatorio de la tarea editada
                    if (notificationPermission) {
                        clearReminderForTask(editTaskId);
                        const updatedTask = tasks.find(t => t.id === editTaskId);
                        if (updatedTask && updatedTask.reminder) {
                            scheduleReminderForTask(updatedTask);
                        }
                    }
                    
                    editTaskId = null;
                    addTaskBtn.innerHTML = '<i class="fas fa-plus"></i> Agregar';
                    priorityBtns.forEach(btn => btn.classList.remove('active'));
                    document.querySelector('.priority-btn[data-priority="low"]').classList.add('active');
                    currentPriority = 'low';
                    
                    // Limpiar campos de recordatorio
                    reminderDate.value = '';
                    reminderTime.value = '';
                    
                    showNotification('Tarea actualizada', 'La tarea se ha actualizado correctamente', 'success');
                    playSound('success');
                } else {
                    // Crear nueva tarea
                    const newTask = {
                        id: Date.now(),
                        text: taskText,
                        completed: false,
                        priority: currentPriority,
                        reminder: reminderDateTime,
                        createdAt: new Date(),
                        completedAt: null,
                        notified: false
                    };
                    
                    tasks.push(newTask);

                    // Programar recordatorio si hay permiso
                    if (notificationPermission && newTask.reminder) {
                        scheduleReminderForTask(newTask);
                    }
                    
                    // Limpiar campos de recordatorio
                    reminderDate.value = '';
                    reminderTime.value = '';
                    
                    showNotification('Tarea agregada', 'Nueva tarea agregada correctamente', 'success');
                    playSound('taskee');
                }
                
                // Limpiar input
                taskInput.value = '';
                // Guardar y renderizar
                saveTasks();
                renderTasks();
                updateStats();
            }
            
            // Función para eliminar una tarea
            function deleteTask(id) {
                if (confirm('¿Estás seguro de que quieres eliminar esta tarea?')) {
                    // Cancelar cualquier recordatorio programado
                    clearReminderForTask(id);
                    tasks = tasks.filter(task => task.id !== id);
                    saveTasks();
                    renderTasks();
                    updateStats();
                    showNotification('Tarea eliminada', 'La tarea se ha eliminado correctamente', 'info');
                    playSound('notification');
                }
            }
            
            // Función para alternar el estado de completado
            function toggleCompleted(id) {
                tasks = tasks.map(task => {
                    if (task.id === id) {
                        const completed = !task.completed;
                        return { 
                            ...task, 
                            completed,
                            completedAt: completed ? new Date() : null
                        };
                    }
                    return task;
                });

                // Gestionar recordatorios según estado
                const toggledTask = tasks.find(t => t.id === id);
                if (toggledTask) {
                    if (toggledTask.completed) {
                        clearReminderForTask(id);
                        toggledTask.notified = false;
                    } else if (notificationPermission && toggledTask.reminder) {
                        scheduleReminderForTask(toggledTask);
                    }
                }
                
                saveTasks();
                renderTasks();
                updateStats();
                
                // Animación
                const taskItem = document.querySelector(`.task-item[data-id="${id}"]`);
                if (taskItem) {
                    taskItem.classList.add('completed-animation');
                    setTimeout(() => {
                        taskItem.classList.remove('completed-animation');
                    }, 500);
                }
                
                const task = tasks.find(t => t.id === id);
                if (task && task.completed) {
                    showNotification('Tarea completada', `Has completado: ${task.text}`, 'success');
                    playSound('success');
                }
            }
            
            // Función para editar una tarea
            function editTask(id) {
                const task = tasks.find(task => task.id === id);
                if (task) {
                    taskInput.value = task.text;
                    taskInput.focus();
                    editTaskId = id;
                    currentPriority = task.priority;
                    
                    // Actualizar botones de prioridad
                    priorityBtns.forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.priority === task.priority) {
                            btn.classList.add('active');
                        }
                    });
                    
                    // Actualizar campos de recordatorio
                    if (task.reminder) {
                        const reminderDateObj = new Date(task.reminder);
                        reminderDate.value = reminderDateObj.toISOString().split('T')[0];
                        reminderTime.value = reminderDateObj.toTimeString().substring(0, 5);
                    } else {
                        reminderDate.value = '';
                        reminderTime.value = '';
                    }
                    
                    addTaskBtn.innerHTML = '<i class="fas fa-save"></i> Guardar';
                }
            }
            
            // Función para limpiar tareas completadas
            function clearCompletedTasks() {
                const completedTasks = tasks.filter(task => task.completed);
                if (completedTasks.length === 0) {
                    showNotification('Info', 'No hay tareas completadas para eliminar', 'info');
                    return;
                }
                
                if (confirm(`¿Estás seguro de que quieres eliminar ${completedTasks.length} tareas completadas?`)) {
                    tasks = tasks.filter(task => !task.completed);
                    saveTasks();
                    renderTasks();
                    updateStats();
                    showNotification('Tareas eliminadas', `Se eliminaron ${completedTasks.length} tareas completadas`, 'info');
                    playSound('notification');
                }
            }
            
            // Función para mostrar notificaciones en la app
            function showNotification(title, message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                let icon = 'fas fa-info-circle';
                if (type === 'success') icon = 'fas fa-check-circle';
                if (type === 'warning') icon = 'fas fa-exclamation-triangle';
                if (type === 'danger') icon = 'fas fa-exclamation-circle';
                
                notification.innerHTML = `
                    <i class="${icon} notification-icon"></i>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                notificationContainer.appendChild(notification);
                
                // Evento para cerrar la notificación
                const closeBtn = notification.querySelector('.notification-close');
                closeBtn.addEventListener('click', () => {
                    notification.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => {
                        notificationContainer.removeChild(notification);
                    }, 300);
                });
                
                // Auto-eliminar después de 5 segundos
                setTimeout(() => {
                    if (notification.parentNode === notificationContainer) {
                        notification.style.animation = 'slideInRight 0.3s ease reverse';
                        setTimeout(() => {
                            notificationContainer.removeChild(notification);
                        }, 300);
                    }
                }, 5000);
            }
            
            // Función para mostrar notificaciones nativas del sistema
            function showSystemNotification(title, message) {
                if (!notificationPermission) return;
                
                // Verificar si el navegador soporta notificaciones
                if (!('Notification' in window)) {
                    return;
                }
                
                // Crear y mostrar la notificación
                const notification = new Notification(title, {
                    body: message,
                    icon: '/icons/icon-192.svg',
                    tag: 'taskee-notification'
                });
                
                // Reproducir sonido de notificación
                playSound('notification');
                
                // Cerrar la notificación después de 10 segundos
                setTimeout(() => {
                    notification.close();
                }, 10000);
                
                // Enfocar la ventana al hacer clic en la notificación
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
            }
            
            // Función para comprobar recordatorios
            function checkReminders() {
                const now = new Date();
                
                tasks.forEach(task => {
                    if (task.reminder && !task.completed && !task.notified) {
                        const reminderTime = new Date(task.reminder);
                        // Notificar 1 minuto antes del recordatorio
                        if (now >= reminderTime - 60000 && now < reminderTime) {
                            showSystemNotification('Recordatorio de Taskee', `La tarea "${task.text}" está próxima a vencer`);
                            showNotification('Recordatorio', `La tarea "${task.text}" está próxima a vencer`, 'warning');
                            task.notified = true;
                            saveTasks();
                        }
                    }
                });
            }
            
            // Iniciar comprobación de recordatorios
            function startNotificationChecker() {
                notificationCheckInterval = setInterval(checkReminders, 30000); // Comprobar cada 30 segundos
            }

            // Programación basada en temporizadores por tarea
            function scheduleReminderForTask(task) {
                clearReminderForTask(task.id);
                if (!task.reminder || task.completed) return;

                const reminderTime = new Date(task.reminder);
                const preTime = new Date(reminderTime.getTime() - 60000); // 1 minuto antes
                const now = new Date();

                let delay = preTime - now;
                // Si ya estamos dentro del último minuto, notificar inmediatamente
                if (delay <= 0 && now < reminderTime) {
                    delay = 0;
                }
                // Si ya pasó el recordatorio, no programar
                if (delay < 0) return;

                reminderTimers[task.id] = setTimeout(() => {
                    showSystemNotification('Recordatorio de Taskee', `La tarea "${task.text}" está próxima a vencer`);
                    showNotification('Recordatorio', `La tarea "${task.text}" está próxima a vencer`, 'warning');
                    task.notified = true;
                    saveTasks();
                }, delay);
            }

            function clearReminderForTask(id) {
                const timerId = reminderTimers[id];
                if (timerId) {
                    clearTimeout(timerId);
                    delete reminderTimers[id];
                }
            }

            function rescheduleAllReminders() {
                if (!notificationPermission) return;
                // Limpiar existentes
                Object.keys(reminderTimers).forEach(clearReminderForTask);
                // Programar pendientes
                tasks.forEach(task => {
                    if (task.reminder && !task.completed && !task.notified) {
                        scheduleReminderForTask(task);
                    }
                });
            }
            
            // Función para renderizar las tareas
            function renderTasks() {
                // Filtrar tareas según el filtro actual
                let filteredTasks = [];
                
                switch (currentFilter) {
                    case 'pending':
                        filteredTasks = tasks.filter(task => !task.completed);
                        break;
                    case 'completed':
                        filteredTasks = tasks.filter(task => task.completed);
                        break;
                    default:
                        filteredTasks = tasks;
                }
                
                // Ordenar tareas
                switch (currentSort) {
                    case 'oldest':
                        filteredTasks.sort((a, b) => a.createdAt - b.createdAt);
                        break;
                    case 'priority':
                        const priorityOrder = { high: 3, medium: 2, low: 1 };
                        filteredTasks.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
                        break;
                    case 'reminder':
                        filteredTasks.sort((a, b) => {
                            if (!a.reminder) return 1;
                            if (!b.reminder) return -1;
                            return a.reminder - b.reminder;
                        });
                        break;
                    default: // newest first
                        filteredTasks.sort((a, b) => b.createdAt - a.createdAt);
                }
                
                // Limpiar lista
                taskList.innerHTML = '';
                
                // Mostrar estado vacío si no hay tareas
                if (filteredTasks.length === 0) {
                    const emptyState = document.createElement('li');
                    emptyState.className = 'empty-state';
                    
                    let message = '';
                    let icon = 'fas fa-clipboard-list';
                    
                    switch (currentFilter) {
                        case 'pending':
                            message = '¡No hay tareas pendientes!';
                            icon = 'fas fa-check-circle';
                            break;
                        case 'completed':
                            message = 'No hay tareas completadas';
                            icon = 'fas fa-inbox';
                            break;
                        default:
                            message = 'No hay tareas. ¡Agrega una nueva!';
                    }
                    
                    emptyState.innerHTML = `
                        <i class="${icon}"></i>
                        <p>${message}</p>
                        <button class="btn" onclick="document.getElementById('task-input').focus()">
                            <i class="fas fa-plus"></i> Crear tarea
                        </button>
                    `;
                    
                    taskList.appendChild(emptyState);
                    return;
                }
                
                // Renderizar tareas
                filteredTasks.forEach(task => {
                    const taskItem = document.createElement('li');
                    taskItem.className = `task-item ${task.completed ? 'completed' : ''} ${task.priority}-priority`;
                    taskItem.dataset.id = task.id;
                    
                    // Comprobar si la tarea es urgente (menos de 1 hora para el recordatorio)
                    const now = new Date();
                    if (task.reminder && !task.completed && (new Date(task.reminder) - now) < 3600000) {
                        taskItem.classList.add('urgent');
                    }
                    
                    // Formatear fecha
                    const createdDate = new Date(task.createdAt).toLocaleDateString();
                    
                    let reminderInfo = '';
                    if (task.reminder) {
                        const reminderDate = new Date(task.reminder);
                        reminderInfo = `<span class="task-date"><i class="fas fa-bell"></i> ${reminderDate.toLocaleString()}</span>`;
                    }
                    
                    taskItem.innerHTML = `
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                        <div class="task-content">
                            <span class="task-text">${task.text}</span>
                            <div class="task-meta">
                                <span class="task-priority ${task.priority}-priority">
                                    <span class="priority-dot"></span>
                                    ${task.priority === 'high' ? 'Alta' : task.priority === 'medium' ? 'Media' : 'Baja'}
                                </span>
                                <span class="task-date">
                                    <i class="fas fa-calendar"></i> ${createdDate}
                                </span>
                                ${reminderInfo}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="task-btn edit-btn">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="task-btn delete-btn">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    if (task.reminder && !task.completed) {
                        taskItem.innerHTML += `<div class="reminder-badge"><i class="fas fa-bell"></i></div>`;
                    }
                    
                    // Event listeners para los elementos de la tarea
                    const checkbox = taskItem.querySelector('.task-checkbox');
                    const editBtn = taskItem.querySelector('.edit-btn');
                    const deleteBtn = taskItem.querySelector('.delete-btn');
                    
                    checkbox.addEventListener('change', () => toggleCompleted(task.id));
                    editBtn.addEventListener('click', () => editTask(task.id));
                    deleteBtn.addEventListener('click', () => deleteTask(task.id));
                    
                    taskList.appendChild(taskItem);
                });
            }
            
            // Función para actualizar las estadísticas
            function updateStats() {
                const totalTasks = tasks.length;
                const completedTasks = tasks.filter(task => task.completed).length;
                const completionPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

                totalTasksEl.textContent = totalTasks;
                completedTasksEl.textContent = completedTasks;
                progressText.textContent = `${completionPercentage}%`;

                const progressBar = document.getElementById('progress-bar');
                if (progressBar) {
                    progressBar.style.width = `${completionPercentage}%`;
                }
            }
            
            // Función para guardar tareas en localStorage
            function saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }
            
            // Función para cargar tareas desde localStorage
            function loadTasks() {
                const savedTasks = JSON.parse(localStorage.getItem('tasks'));
                if (savedTasks) {
                    tasks = savedTasks;
                    renderTasks();
                    // Programar recordatorios cargados si hay permiso
                    if (notificationPermission) {
                        rescheduleAllReminders();
                    }
                }
            }
        });
    </script>
</body>
</html>